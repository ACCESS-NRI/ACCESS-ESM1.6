# This is a Spack Environment file.
#
# It describes a set of packages to be installed, along with
# configuration settings.
spack:
  specs:
    # The root Spack Bundle Recipe (SBR) for the model and overall version of
    # the deployment:
    # TODO: Replace the MODEL and VERSION.
    # - MODEL@git.VERSION
    - access-esm1p6@git.2024.10.0

  packages:
    # Specification of dependency versions and variants. CI/CD requires that
    # the first element of the require is only a version:
    # TODO: Specify versions and variants of dependencies as required.
    # openmpi:
    #   require:
    #     - '@4.1.5'
    mom5:
      require:
        - '@git.development=access-esm1.6'
    cice4:
      require:
        - '@git.2024.05.21=access-esm1.5'
    # @d09ee72..bca0757    
    um7:
      require:
        - '@git.18-esm15-cable3=access-esm1.5'
    # Lower-level ACCESS-NRI dependencies
    gcom4:
      require:
        - '@git.2024.05.28=access-esm1.5'
    oasis3-mct:
      require:
        - '@git.access-esm1.5_2024.05.24=access-esm1.5'
    # Other dependencies
    openmpi:
      require:
        - '@4.0.2'
    netcdf-c:
      require:
        - '@4.7.4'
    netcdf-fortran:
      require:
        - '@4.5.2'
    hdf5:
      require:
        - '@1.10.11'


    access-fms:
      require:
        - '@development'
    access-generic-tracers:
      require:
        - '@development'
    access-mocsy:
      require:
        - '@mom5'
    # Preferences for all packages
    all:
      # TODO: Specify compiler/targets for all packages
       require:
         - '%intel@19.0.5.281'
         - 'target=x86_64'
  view: true
  concretizer:
    unify: true
  modules:
    default:
      enable:
        - tcl
      roots:
        tcl: $spack/../release/modules
        lmod: $spack/../release/lmod
      tcl:
        hash_length: 0
        include:
          # TODO: Add MODEL and PACKAGEs that will have a corresponding module
          # - MODEL
          # - PACKAGE1
          # - PACKAGE2
          - access-esm1p6
          - cice4
          - um7
          - mom5
        exclude_implicits: true
        all:
          autoload: run
          conflict:
            - '{name}'
          environment:
            set:
              'SPACK_{name}_ROOT': '{prefix}'

        projections:
          # These projection VERSIONs must be the same as the
          # `spack.packages.*.require[0]` VERSION but without the `@git.` and
          # without the RHS of the equals sign, if there is one.
          #
          # For a MODEL, an example projection is `{name}/2024.10.0`.
          # For a PACKAGE where `require` VERSION is
          # `@git.2024.04.21=access-esm1.5`, the projection becomes
          # `{name}/2024.04.21-{hash:7}`.
          # TODO: Add explicit projections for modules that will be found with
          #       `module load`.
          # MODEL: '{name}/VERSION'
          # PACKAGE1: '{name}/VERSION1-{hash:7}'
          # PACKAGE2: '{name}/VERSION2-{hash:7}'
          all: '{name}/{version}'
          access-esm1p6: '{name}/2024.10.0'
          cice4: '{name}/2024.05.21'
          um7: '{name}/18-esm15-cable3'
          mom5: '{name}/development'
  # config:
  #   overridden spack configurations, if needed
  # mirrors:
  #   overridden spack package tarball directories, if needed
  # repos:
  #   overridden repo sources, if needed
  config:
    install_tree:
      root: $spack/../restricted/ukmo/release
    source_cache: $spack/../restricted/ukmo/source_cache
    build_stage:
    - $TMPDIR/restricted/spack-stage
